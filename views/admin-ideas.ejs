<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('partials/head', { title: '–ò–¥–µ–∏' }) %>
    <style>
        body { background: #050505; color: #fff; padding-top: 120px; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: #111; border: 1px solid #333; padding: 20px; margin-bottom: 20px; border-radius: 15px; }
        .actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <%- include('partials/navbar') %>
    <div class="container">
        <h1>üí° –ù–æ–≤—ã–µ –∏–¥–µ–∏ (<%= ideas.length %>)</h1>
        
        <% ideas.forEach(idea => { %>
            <div class="card" id="idea-<%= idea._id %>">
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">
                    <%= idea.username %> ‚Ä¢ <%= new Date(idea.createdAt).toLocaleDateString() %>
                </div>
                <h3 style="margin: 0 0 10px;"><%= idea.title %></h3>
                <div style="background: #222; padding: 15px; border-radius: 8px; white-space: pre-wrap;"><%= idea.description %></div>
                
                <div class="actions">
                    <button class="btn" style="background: #2ecc71;" onclick="decide('<%= idea._id %>', 'APPROVED')">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                    <button class="btn" style="background: #3498db;" onclick="decide('<%= idea._id %>', 'IMPLEMENTED')">üöÄ –°–¥–µ–ª–∞–Ω–æ</button>
                    <button class="btn" style="background: #e74c3c;" onclick="decide('<%= idea._id %>', 'REJECTED')">‚ùå –û—Ç–∫–∞–∑</button>
                </div>
            </div>
        <% }) %>
    </div>

    <script nonce="<%= nonce %>">
        async function decide(id, status) {
            const comment = prompt("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):", "");
            try {
                await fetch('/api/admin/ideas/decide', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ideaId: id, status, comment })
                });
                document.getElementById('idea-' + id).remove();
            } catch (e) { alert('–û—à–∏–±–∫–∞'); }
        }
    </script>
</body>
</html>