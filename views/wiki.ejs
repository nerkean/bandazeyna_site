<!DOCTYPE html>
<html lang="ru">
<head>
    <%- include('partials/head', { title: 'База Знаний | Дача Зейна' }) %>
    
    <link rel="preload" href="/css/wiki.css" as="style">
    <link rel="stylesheet" href="/css/wiki.css">
</head>
<body>
    <%- include('partials/navbar') %>

    <main>
        <div class="wiki-hero">
          <h1 class="wiki-h1">База Знаний сообщества «Дача Зейна»</h1>
<p style="text-align: center; color: var(--text-muted); margin-top: -20px; margin-bottom: 30px;">
    Гайды по Bee Swarm Simulator, правила сервера и инструкции по сайту.
</p>
            <form action="/wiki" method="GET" class="search-box">
                <input type="text" name="q" class="search-input" placeholder="Поиск..." value="<%= searchQuery || '' %>">
                <button type="submit" class="search-btn" aria-label="Найти">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <div class="wiki-container">
            <% const cats = [
                { id: 'guides', name: 'Гайды и Советы', icon: 'fas fa-book-open' },
                { id: 'items', name: 'Предметы', icon: 'fas fa-cube' },
                { id: 'bees', name: 'Пчелы', icon: 'fas fa-bug' },
                { id: 'mechanics', name: 'Механики', icon: 'fas fa-cogs' },
                { id: 'server', name: 'О Сервере', icon: 'fas fa-info-circle' }
            ]; %>

           <% cats.forEach(cat => { %>
    <% if (categories[cat.id] && categories[cat.id].length > 0) { %>
        <section class="cat-section"> <h2 class="cat-title"><i class="<%= cat.icon %>"></i> <%= cat.name %></h2>
            <div class="articles-grid">
                <% categories[cat.id].forEach(art => { %>
                    <a href="/wiki/<%= art.slug %>" class="art-card" title="<%= art.title %>">
                        <article> <div class="art-icon"><i class="<%= art.icon %>"></i></div>
                            <h3 class="art-title"><%= art.title %></h3> <p class="art-desc"><%= art.description %></p>
                            <div class="art-meta">
                                <span><i class="far fa-eye"></i> <%= art.views %></span>
                                <span><i class="far fa-calendar"></i> <%= new Date(art.createdAt).toLocaleDateString() %></span>
                            </div>
                        </article>
                    </a>
                <% }) %>
            </div>
        </section>
    <% } %>
<% }); %>

            <% if (Object.values(categories).flat().length === 0) { %>
                <div style="text-align: center; color: #888; padding: 50px;">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <h3>Ничего не найдено</h3>
                </div>
            <% } %>
        </div>
    </main>

    <%- include('partials/footer') %>

    <script nonce="<%= nonce %>">
        const loadAnalytics = () => {
            if (window.analyticsLoaded) return;
            window.analyticsLoaded = true;

            const gtmScript = document.createElement('script');
            gtmScript.async = true;
            gtmScript.src = 'https://www.googletagmanager.com/gtag/js?id=AW-17815408362'; 
            document.head.appendChild(gtmScript);

            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'AW-17815408362');

            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "um1b962jsc");
        };

        window.addEventListener('scroll', loadAnalytics, { once: true });
        window.addEventListener('mousemove', loadAnalytics, { once: true });
        window.addEventListener('touchstart', loadAnalytics, { once: true });
        setTimeout(loadAnalytics, 3500);
    </script>
</body>
</html>